# Verso

A self-evolving personal AI assistant platform with multi-channel messaging support.

Verso enhances the personal AI agent experience by enabling **asynchronous tool execution**, **dynamic context retrieval**, and **self-evolving code optimization** — letting the AI assistant gradually adapt to each user's workflow over time.

## Quick Start

```bash
# 1. Prerequisites: Node.js >= 22.12.0, pnpm 10.23.0
node --version && pnpm --version

# 2. Clone and install
git clone https://github.com/JuliusYang3311/verso-agent.git verso
cd verso
pnpm install

# 3. Build
pnpm build

# 4. Interactive onboarding (sets up everything)
pnpm verso onboard

# 5. Start the gateway (if not installed as service during onboard)
pnpm verso gateway run
```

## Step-by-Step Setup

### 1. Install Dependencies

```bash
pnpm install
```

This installs all packages and creates the `verso` CLI symlink. If pnpm is not installed:

```bash
corepack enable && corepack prepare pnpm@10.23.0 --activate
```

### 2. Build

```bash
pnpm build
```

Compiles TypeScript to `dist/` via tsdown, generates plugin-sdk types, and copies assets.

### 3. Onboard

```bash
pnpm verso onboard
```

The interactive wizard walks you through the full setup:

**Security acknowledgement** — Confirm you understand the risks (Verso can run shell commands, access files, etc.)

**Auth provider** — Choose your LLM provider and enter the API key:

```
? Auth provider
  > Anthropic (setup-token)
    OpenAI
    OpenRouter
    Google Gemini
    xAI
    Moonshot/Kimi
    ... (12+ providers)
    Skip
```

**Model selection** — Pick your primary LLM and embedding model.

**Gateway configuration** — Set port, bind address, and auth:

```
? Gateway port: 8080
? Bind mode: loopback (127.0.0.1 only)
? Auth mode: token
? Auth token: <auto-generated or enter your own>
```

**Channel setup** — Connect one or more chat platforms:

```
? Configure chat channels now? Yes
? Channel: Telegram
  > Configure  |  Skip
? Telegram bot token: 123456:ABC-DEF...
```

Supported channels: **Telegram**, **Discord**, **Slack**, **WhatsApp**, **Feishu (Lark)**

**Skills installation** — Choose from 60+ skills (GitHub, Gmail, Calendar, crypto-trading, web-search, etc.)

**Gateway service** — Install as a background service (launchd on macOS, systemd on Linux):

```
? Install Gateway service? Yes
  Gateway service installed and started.
```

**Health check** — Automatically verifies everything is working.

**Control UI** — Opens the web dashboard or TUI to start chatting.

#### QuickStart vs Advanced

- `pnpm verso onboard` — defaults to QuickStart (minimal prompts, sensible defaults)
- `pnpm verso onboard --flow advanced` — full control over every setting

#### Non-Interactive (for automation)

```bash
pnpm verso onboard --non-interactive --accept-risk \
  --auth-choice anthropic --token sk-ant-... \
  --gateway-port 8080 --install-daemon
```

### 4. Configure (Post-Setup)

To change settings after initial setup:

```bash
pnpm verso configure
```

This shows an interactive menu of configuration sections:

```
? Select section to configure:
  > Model          — Switch LLM provider or API key
    Gateway        — Port, bind, auth, Tailscale
    Channels       — Add/remove chat platforms
    Skills         — Install/manage skills
    Evolver        — Self-optimization settings
    Web tools      — Brave Search, web fetch
    Compaction     — Token limits, memory flush
    Crypto         — Wallet & exchange keys
    Health check   — Run diagnostics
    Continue       — Save and exit
```

You can also jump directly to a specific section:

```bash
# Reconfigure just the gateway
pnpm verso configure --section gateway

# Update channels and skills
pnpm verso configure --section channels --section skills

# Change model/API key
pnpm verso configure --section model
```

### 5. Gateway

The gateway is the WebSocket server that all channels connect to.

```bash
# Run in foreground (development)
pnpm verso gateway run

# Or manage as a background service (production)
pnpm verso gateway install    # install as system service
pnpm verso gateway start      # start the service
pnpm verso gateway stop       # stop the service
pnpm verso gateway restart    # restart
pnpm verso gateway status     # check if running
pnpm verso gateway health     # health check
```

Open the Control UI: `http://localhost:8080` (or your configured port).

### 6. Verify

```bash
# System health check
pnpm verso doctor

# Auto-fix issues
pnpm verso doctor --fix

# View overall status
pnpm verso status
```

## Configuration

### Config file

```
~/.verso/verso.json
```

### Minimal manual config

```json5
{
  models: {
    providers: {
      anthropic: { apiKey: "sk-ant-..." },
    },
  },
  gateway: {
    port: 8080,
    auth: { mode: "token", token: "your-secret-token" },
  },
}
```

### Environment variables

Set via shell, `.env` file (project root or `~/.verso/.env`), or config `env.vars` block:

| Variable                              | Purpose                  |
| ------------------------------------- | ------------------------ |
| `ANTHROPIC_API_KEY`                   | Anthropic (Claude)       |
| `OPENAI_API_KEY`                      | OpenAI                   |
| `OPENROUTER_API_KEY`                  | OpenRouter (multi-model) |
| `GEMINI_API_KEY`                      | Google Gemini            |
| `TELEGRAM_BOT_TOKEN`                  | Telegram bot             |
| `DISCORD_BOT_TOKEN`                   | Discord bot              |
| `SLACK_BOT_TOKEN`                     | Slack bot                |
| `FEISHU_APP_ID` / `FEISHU_APP_SECRET` | Feishu                   |

See [docs/environment.md](docs/environment.md) for the full precedence chain.

## Channels

| Channel      | How to connect                                                                                                 |
| ------------ | -------------------------------------------------------------------------------------------------------------- |
| **Telegram** | Create bot via [@BotFather](https://t.me/BotFather), set `TELEGRAM_BOT_TOKEN`                                  |
| **Discord**  | Create app at [Discord Developer Portal](https://discord.com/developers/applications), set `DISCORD_BOT_TOKEN` |
| **WhatsApp** | Run `pnpm verso channels login --channel whatsapp`, scan QR code                                               |
| **Slack**    | Create app at [api.slack.com](https://api.slack.com/apps), set `SLACK_BOT_TOKEN` + `SLACK_SIGNING_SECRET`      |
| **Feishu**   | Create app at [Feishu Open Platform](https://open.feishu.cn), set `FEISHU_APP_ID` + `FEISHU_APP_SECRET`        |

## Key Features

### Asynchronous Tool Execution

Agent tool calls run asynchronously in the background. The agent continues responding while tools execute — no blocking.

- Message I/O layer and turn execution layer are fully decoupled
- New messages are steered into active turns via `steer()` without interruption
- Tool completion triggers automatic agent resume

### Dynamic Context Retrieval

Instead of feeding full conversation history into each LLM call, Verso dynamically selects what to include:

- **Token-budget recent messages** — keeps recent messages based on budget, not fixed count
- **Vector retrieval** — retrieves relevant older messages using similarity threshold with time-decay
- **Adaptive ratio** — adjusts balance based on conversation pace and tool usage
- All hyperparameters are tunable by the Evolver

### Self-Evolving Code (Evolver)

The Evolver is a background daemon that automatically optimizes the agent:

- **Sandbox-first** — all code changes tested in isolation before deployment
- **Automatic rollback** — failed changes reverted, recorded in `errors.jsonl`
- **Signal-driven** — extracts signals from logs (slow responses, high token usage, user corrections)
- **Hyperparameter tuning** — auto-adjusts context parameters based on feedback

Configure in `verso.json`:

```json5
{ evolver: { review: true } } // require human review before deploy
```

Logs: `~/.verso/logs/evolver-daemon.log`

## Command Reference

| Command                     | Description                  |
| --------------------------- | ---------------------------- |
| `pnpm verso onboard`        | Interactive first-time setup |
| `pnpm verso configure`      | Modify existing config       |
| `pnpm verso gateway run`    | Start gateway (foreground)   |
| `pnpm verso gateway start`  | Start gateway service        |
| `pnpm verso gateway stop`   | Stop gateway service         |
| `pnpm verso gateway status` | Check gateway status         |
| `pnpm verso gateway health` | Gateway health check         |
| `pnpm verso doctor`         | System diagnostics           |
| `pnpm verso doctor --fix`   | Auto-fix issues              |
| `pnpm verso status`         | Overall status               |
| `pnpm verso channels login` | Connect a channel            |
| `pnpm verso dashboard`      | Open web Control UI          |
| `pnpm verso update`         | Self-update                  |
| `pnpm build`                | Build from source            |
| `pnpm test`                 | Run test suite               |
| `pnpm lint`                 | Lint check                   |

## Architecture

```
User Message
    │
    ▼
┌─────────────────────────────────────────┐
│         Message I/O Layer               │
│  Routes messages, manages steer()       │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│      Dynamic Context Builder            │
│  Token-budget recent + vector retrieval │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│      Async Turn Execution               │
│  LLM → tool_use → execute → LLM → ...  │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│      Evolver (Background Daemon)        │
│  Signals → mutation → sandbox → deploy  │
└─────────────────────────────────────────┘
```

## Project Structure

```
src/
  agents/          # Agent runtime, tools, dynamic context
  auto-reply/      # Message routing and dispatch
  evolver/         # Self-evolution engine (GEP protocol)
    gep/           # Gene Expression Programming modules
    ops/           # Lifecycle and build verification
    assets/        # Tunable parameters and logs
  gateway/         # HTTP/WebSocket gateway server
  memory/          # Vector memory with sqlite-vec
  config/          # Configuration and schema
  approval/        # Exec approval workflow
  heartbeat/       # Heartbeat and wake mechanisms
  env/             # Environment and shell utilities
  telegram/        # Telegram channel
  discord/         # Discord channel
  slack/           # Slack channel
  web/             # WhatsApp (Baileys) channel
  channels/        # Channel plugin system
extensions/        # 32 active extensions
skills/            # 65 skills (20 core)
docs/              # Documentation
```

## Tech Stack

- **Runtime**: Node.js >= 22.12.0
- **Language**: TypeScript (ESM)
- **Package Manager**: pnpm 10.23.0
- **Core Framework**: @mariozechner/pi-agent-core 0.52.9
- **Vector DB**: sqlite-vec (hybrid vector + BM25 search)
- **Build**: tsdown (rolldown-based bundler)
- **Testing**: Vitest (998 files, 6768 tests)

## Directory Layout After Setup

```
~/.verso/
├── verso.json              # Main config
├── .env                    # Environment variables (optional)
└── logs/
    ├── verso-YYYY-MM-DD.log    # Gateway logs
    ├── evolver-daemon.log      # Evolver logs
    └── evolver-daemon.pid      # Evolver PID

~/verso/                    # Workspace (configurable)
├── AGENT.md                # Agent identity
├── SOUL.md                 # Agent values
├── MEMORY.md               # Long-term memory
├── USER.md                 # User profile
├── memory/                 # Vector DB (sqlite-vec)
└── skills/                 # Installed skills
```

## Acknowledgments

This project is derived from [OpenClaw/MoltBot](https://github.com/moltbot/moltbot), originally created by **Peter Steinberger**. The OpenClaw framework provided the foundational multi-channel AI gateway architecture upon which Verso's async execution, dynamic context, and self-evolution capabilities were built. We sincerely thank Peter Steinberger and all OpenClaw contributors for their excellent work.

## License

MIT License. See [LICENSE](LICENSE) for details.
